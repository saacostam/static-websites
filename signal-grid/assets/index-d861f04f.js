var T=Object.defineProperty;var P=(n,t,e)=>t in n?T(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var h=(n,t,e)=>(P(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();var u=(n=>(n[n.UP=0]="UP",n[n.RIGHT=1]="RIGHT",n[n.DOWN=2]="DOWN",n[n.LEFT=3]="LEFT",n[n.NONE=4]="NONE",n))(u||{});const y=[0,1,2,3];var g=(n=>(n[n.DEGREES_0=0]="DEGREES_0",n[n.DEGREES_90=1]="DEGREES_90",n[n.DEGREES_180=2]="DEGREES_180",n[n.DEGREES_270=3]="DEGREES_270",n))(g||{});class R{constructor(t,e){this.x=t,this.y=e}}const d={WIDTH:1200,HEIGHT:600},f={COLUMNS:16,ROWS:8,RANDOM_MODE:!1,RPI:10},H={OFF:"#1565c0",ON:"#c62828"};class p extends Error{constructor(t){super(`Error in game setup: ${t}`)}}class Q extends Error{constructor(t){super(`Error in game input: ${t}`)}}class k extends Error{constructor(t){super(`Error in game runtime: ${t}`)}}const W=class W{constructor(t){h(this,"columns",f.COLUMNS);h(this,"rows",f.ROWS);h(this,"width",d.WIDTH);h(this,"height",d.HEIGHT);h(this,"tileWidth",d.WIDTH/f.COLUMNS);h(this,"tileHeight",d.HEIGHT/f.ROWS);this.agents=t}createAgents(t,e){const i=[],s=t/this.columns,r=e/this.rows;for(let o=0;o<t;o+=s)for(let a=0;a<e;a+=r){const c=new m(o,a,s,r,this.randomSides(),[g.DEGREES_0,g.DEGREES_90,g.DEGREES_180,g.DEGREES_270][Math.floor(Math.random()*4)]);i.push(c)}return i[0]=new C(0,0,s,r,[]),i}findNeighbors(t,e){const i=t/this.tileWidth,s=e/this.tileHeight,r=[];return W.neighborsMap.forEach(o=>{const a=(i+o.x)*this.tileWidth,c=(s+o.y)*this.tileHeight;if(0<=a&&a<this.width&&0<=c&&c<this.height){const w=this.agents.find(S=>S.x===a&&S.y===c);if(!w)throw new k("Trying to access undefined neighbor!");const l={target:w,direction:o.targetReceivesFrom};r.push(l)}}),r}randomSides(){let t=[];const e=2+[0,1][Math.floor(Math.random()*2)];for(let i=0;i<e;i++){let s=null;for(;!s||t.find(o=>o.side===s);)s=y[Math.floor(Math.random()*y.length)];const r={side:s,hasFlow:!1};t.push(r)}return t}};h(W,"neighborsMap",[{x:1,y:0,targetReceivesFrom:u.LEFT},{x:-1,y:0,targetReceivesFrom:u.RIGHT},{x:0,y:1,targetReceivesFrom:u.UP},{x:0,y:-1,targetReceivesFrom:u.DOWN}]);let v=W;class b{constructor(t,e,i,s){this.canvas=t,this.eventQueue=e,this.agents=i,this.game=s,this.canvas.addEventListener("click",r=>{const{offsetX:o,offsetY:a}=r,c=d.WIDTH/f.COLUMNS,w=d.HEIGHT/f.ROWS,l=Math.floor(o/c)*c,S=Math.floor(a/w)*w,x=this.agents.find(F=>F.x===l&&F.y===S);if(!x)throw new Q("Click does not match with an element on screen!");if(this.eventQueue.add(new G(x)),this.startFlow(),s.isGameOver)return s.start()})}startFlow(){this.agents.forEach(e=>{e instanceof m&&e.disconnect()});const t=this.agents.find(e=>e.x===0&&e.y===0);if(!t)throw new p("Source element not found in expected position");this.eventQueue.add(new E(t,t,u.NONE,this.agents,new Set))}randomize(){for(let t=0;t<f.RPI;t++){const e=this.agents[Math.ceil(Math.random()*this.agents.length)];e instanceof m&&(e.isConnected||(Math.random()<.5?e.rotate():e.backRotate()))}this.startFlow()}}class M{static reverseDirection(t){return y[(t+2)%4]}}class C{constructor(t,e,i,s,r,o=g.DEGREES_0){h(this,"rotation");this.x=t,this.y=e,this.width=i,this.height=s,this.sides=r,this.rotation=o}draw(t){t.beginPath(),t.lineWidth=.1,t.fillStyle=H.ON,t.roundRect(this.x,this.y,this.width,this.height,[0,this.width/3,this.width/3,this.width/3]),t.stroke(),t.fill()}update(t){if(t instanceof E){const{agents:e,visited:i}=t;return i.add(this),new v(e).findNeighbors(this.x,this.y).map(a=>new E(this,a.target,a.direction,e,i))}}}class m{constructor(t,e,i,s,r,o=g.DEGREES_0){h(this,"rotation");h(this,"isConnected",!1);this.x=t,this.y=e,this.width=i,this.height=s,this.sides=r,this.rotation=o,this.generalRotate(o)}draw(t){const e=this.x+this.width/2,i=this.y+this.height/2,s=this.width/6,r=this.isConnected?H.ON:H.OFF;t.beginPath(),t.arc(e,i,s,0,2*Math.PI,!1),t.lineWidth=1,t.strokeStyle=r,t.fillStyle=r,t.fill(),t.stroke(),this.sides.forEach(o=>{const a=o.hasFlow?this.width/2:this.width/4;let c;switch(o.side){case u.DOWN:c=new R(e,i+a);break;case u.RIGHT:c=new R(e+a,i);break;case u.UP:c=new R(e,i-a);break;case u.LEFT:c=new R(e-a,i);break}c&&(t.lineWidth=this.width/5,t.strokeStyle=r,t.lineCap="round",t.beginPath(),t.moveTo(e,i),t.lineTo(c.x,c.y),t.stroke())})}update(t){if(t instanceof G)this.rotate();else if(t instanceof E){const{agents:e,visited:i,direction:s,origin:r}=t,o=[],a=this.sides.find(l=>l.side===s);return a?(a.hasFlow=!0,this.isConnected=!0,i.add(this),o.push(new O(this,r,M.reverseDirection(s))),new v(e).findNeighbors(this.x,this.y).forEach(l=>{l.target instanceof C||l.target instanceof m&&l.target.isConnected||!this.sides.find(x=>x.side===M.reverseDirection(l.direction))||o.push(new E(this,l.target,l.direction,e,i))}),o):void 0}else if(t instanceof O){const{direction:e}=t,i=this.sides.find(s=>s.side===e);if(!i)return;i.hasFlow=!0}}disconnect(){this.isConnected=!1,this.sides.forEach(t=>t.hasFlow=!1)}rotate(){this.generalRotate(1)}backRotate(){this.generalRotate(-1)}generalRotate(t){this.rotation+=t,this.sides.forEach(e=>e.side=(e.side+t+y.length)%y.length)}}class E{constructor(t,e,i,s,r){h(this,"visited");this.origin=t,this.target=e,this.direction=i,this.agents=s,this.visited=r}}class O{constructor(t,e,i){this.origin=t,this.target=e,this.direction=i}}class G{constructor(t){this.target=t}}class L{constructor(){h(this,"inputEvents",[]);h(this,"interactionEvents",[])}add(t){t instanceof G?this.inputEvents.push(t):this.interactionEvents.push(t)}pop(){if(this.inputEvents.length>0)return this.inputEvents.shift();if(this.interactionEvents.length>0)return this.interactionEvents.shift()}isEmpty(){return this.inputEvents.length===0&&this.interactionEvents.length===0}}class U{constructor(t){h(this,"agents",[]);h(this,"ctx");h(this,"eventQueue");h(this,"clickHandler");h(this,"isGameOver");this.canvas=t;const e=this.canvas.getContext("2d");if(!e)throw new p("Could not find a 2d canvas context!");this.ctx=e,this.eventQueue=new L;const i=new v(this.agents);this.agents=i.createAgents(d.WIDTH,d.HEIGHT),this.clickHandler=new b(this.canvas,this.eventQueue,this.agents,this);const s=this.agents.find(r=>r.x===0&&r.y===0);if(!s)throw new p("Source element not found in expected position");this.eventQueue.add(new E(s,s,u.NONE,this.agents,new Set)),this.isGameOver=!1,this.loop()}update(){for(;!this.eventQueue.isEmpty();){const t=this.eventQueue.pop(),e=t==null?void 0:t.target.update(t);e&&Array.isArray(e)?e.forEach(i=>this.eventQueue.add(i)):e&&this.eventQueue.add(e)}}clearCanvas(){this.ctx.clearRect(0,0,d.WIDTH,d.HEIGHT)}draw(){this.clearCanvas(),this.agents.forEach(t=>t.draw(this.ctx))}loop(){this.update(),this.draw(),this.isTheEnd()?this.handleGameEnd():window.requestAnimationFrame(this.loop.bind(this))}isTheEnd(){return this.agents.reduce((e,i)=>{let s=0;return i instanceof m&&(s=i.isConnected?1:0),e+s},0)===f.COLUMNS*f.ROWS-1}handleGameEnd(){this.isGameOver=!0,this.ctx.clearRect(0,0,d.WIDTH,d.HEIGHT),this.ctx.font="64px Arial",this.ctx.textAlign="center",this.ctx.fillStyle=H.ON,this.ctx.fillText("You Won!",this.canvas.width/2,this.canvas.height/2),this.ctx.font="32px Arial",this.ctx.fillStyle=H.OFF,this.ctx.fillText("Click to restart!",this.canvas.width/2,this.canvas.height*2/3)}start(){this.eventQueue=new L;const t=new v(this.agents);this.agents=t.createAgents(d.WIDTH,d.HEIGHT),this.clickHandler=new b(this.canvas,this.eventQueue,this.agents,this);const e=this.agents.find(i=>i.x===0&&i.y===0);if(!e)throw new p("Source element not found in expected position");this.eventQueue.add(new E(e,e,u.NONE,this.agents,new Set)),this.isGameOver=!1,this.loop()}}const _=document.getElementById("app");if(!_)throw new p("No app div was found!");const D=document.createElement("canvas");D.width=d.WIDTH;D.height=d.HEIGHT;if(!D)throw new p("No canvas element was found!");_.append(D);new U(D);
